Use the WS and WG data to calculate the proportion of children that produce/understand each word, and each word's age of acquisition.
```{r}
# group_by_not <- function(.data, ..., add = FALSE) {
#   group_by_not_(.data, .dots = lazyeval::lazy_dots(...), add = add)
#   }
# 
# group_by_not_ <- function(.data, ..., .dots, add = FALSE) {
#   group_by_(.data, .dots = Filter(function(name) !(name %in% Map(function(lazy) lazy$expr, .dots)),
#                                   names(.data)))
# }

by_age <- raw_data %>%
  group_by_not(data_id, value) %>%
  summarise(prop = mean(value, na.rm = TRUE))

aoa <- by_age %>%
  summarise(aoa = age[min(which(prop > 0.5))])

prop <- raw_data %>%
  group_by_not(age, data_id, value) %>%
  summarise(prop = mean(value, na.rm = TRUE))

by_item <- inner_join(aoa, prop)

lang_n <- admins %>%
  group_by(language) %>%
  summarise(n = n())

age_n <- admins %>%
  group_by(language, age) %>%
  summarise(n = n())
ages <- bind_rows(mutate(age_n, measure = "produces"),
                  mutate(age_n, measure = "understands"))
```

```{r}
ggplot(filter(by_item, measure == "understands"), aes(x = prop)) +
  facet_wrap(~language) +
  geom_bar(aes(fill = lexical_category)) +
  scale_fill_solarized()

ggplot(filter(by_item, measure == "produces"), aes(x = prop)) +
  facet_wrap(~language) +
  geom_bar(aes(fill = lexical_category)) +
  scale_fill_solarized()

ggplot(filter(by_item, measure == "understands"), aes(x = aoa)) +
  facet_wrap(~language) +
  geom_bar(aes(fill = lexical_category)) +
  geom_point(aes(x = age, y = n), data = ages) +
  scale_fill_solarized()

ggplot(filter(by_item, measure == "produces"), aes(x = aoa)) +
  facet_wrap(~language) +
  geom_bar(aes(fill = lexical_category)) +
  geom_point(aes(x = age, y = n), data = ages) +
  scale_fill_solarized()
```

```{r}
ggplot(by_age, aes(x = age, y = prop, group = item, colour = lexical_category)) +
  facet_grid(language ~ measure) +
  geom_line() +
  scale_colour_solarized()
```

```{r}
colors <- c("red", "orange", "yellow", "green", "blue",
            "purple", "pink", "brown", "black", "white")
color_data <- by_age %>%
  filter(uni_lemma %in% colors)
ggplot(color_data, aes(x = age, y = prop, colour = uni_lemma)) +
  facet_grid(measure~language) +
  geom_smooth(method = "loess", se = FALSE) +
  scale_colour_solarized()
```

Now pull in the CHILDES data and the MRC data, get all three to have words in the same form, and put them all together.
```{r}
words <- wswg_data %>%
  mutate(word = sapply(strsplit(item, "\\."), function(strsp) strsp[1])) %>%
  filter(!grepl("_", word)) %>%
  ungroup() %>%
  select(form, measure, word, aoa, prop, category, lexical_category)

words$word[words$word == 'grrr'] <- 'grr'
words$word[words$word == 'inside'] <- 'in'

psycholing <- read_csv('data/psycholing.csv') %>%
  rename(word = WORD, frequency = BFRQ, concreteness = CNC, familiarity = FAM,
         imageability = IMG, num_phonemes = NPHN, num_syllables = NSYL) %>%
  mutate(word = tolower(word),
         brown_log_frequency = log(frequency)) %>%
  select(-frequency)

childes <- read_csv('data/childes_freqs.csv') %>%
  gather(word, freq) %>%
  group_by(word) %>%
  summarise(cds_log_frequency = log(sum(freq))) %>%
  mutate(word = gsub("'", "", tolower(word))) %>%
  filter(!grepl(" ", word), cds_log_frequency > 0)

word_data <- words %>%
  left_join(psycholing) %>%
  left_join(childes)

plot_data <- word_data %>%
  gather(predictor, value, -form, -measure, -word, -aoa, -prop,
         -category, -lexical_category)
```

Plot the WS results.
```{r, fig.width=12, fig.height=10}
ggplot(filter(plot_data, form == "WS"),
       aes(x = value, y = aoa)) +
  facet_wrap(~ predictor, scales = "free_x") +
  geom_point(aes(colour = lexical_category)) +
  geom_smooth(aes(colour = lexical_category), method = "lm", se = FALSE) +
  geom_smooth(colour = "black", method = "lm", se = FALSE) +
  scale_colour_solarized() +
  xlab("") +
  ylab("Age of acquisition (months)")
```

Plot the WG results.
```{r, fig.width=12, fig.height=10}
ggplot(filter(plot_data, form == "WG"),
       aes(x = value, y = aoa, colour = lexical_category)) +
  facet_wrap(~ predictor, scales = "free_x") +
  geom_point(aes(colour = lexical_category)) +
  geom_smooth(aes(colour = lexical_category), method = "lm", se = FALSE) +
  geom_smooth(colour = "black", method = "lm", se = FALSE) +
  scale_colour_solarized() +
  xlab("") +
  ylab("Age of acquisition (months)")
```

Model the results by lexical category separately for each predictor.
```{r}
predictor_models <- function(input_form, predictor) {
  word_data %>%
    filter(form == input_form) %>%
    split(.$lexical_category) %>%
    map(~ lm(interp(quote(aoa ~ p), p = as.name(predictor)), data = .)) %>%
   map(tidy) %>%
   map(function(model) c(model$estimate[2], model$p.value[2]))
  }

predictor_values <- function(input_form, predictor) {
  pm <- predictor_models(input_form, predictor)
  data.frame(predictor = predictor,
             lexical_category = names(pm),
             estimate = unlist(map(pm, function(v) v[1])),
             p_value = unlist(map(pm, function(v) v[2])),
             row.names = NULL)
  }

predictors <- c("concreteness", "familiarity", "imageability", "num_phonemes",
                "num_syllables", "brown_log_frequency", "cds_log_frequency")

form_values <- function(input_form) {
  map(predictors, function(p) predictor_values(input_form, p)) %>%
    bind_rows() %>%
    mutate(stars = unlist(map(p_value, get_stars))) %>%
    split(.$lexical_category)
  }
```

For WS:
```{r}
form_values("WS")
```

For WG:
```{r}
form_values("WG")
```

Model the results with all of the predictors.
```{r}
combined_model <- function(input_form) {
  lm(aoa ~ cds_log_frequency + brown_log_frequency + concreteness + familiarity + imageability + num_phonemes + num_syllables,
     data = filter(word_data, form == input_form)) %>%
    summary()
  }
```

For WS:
```{r}
combined_model("WS")
```

For WG:
```{r}
combined_model("WG")
```

Another way of looking at things: plot each CDI category's mean age of acquisition against its mean child-directed speech frequency.
```{r, fig.width=12, fig.height=6}
cat_means <- word_data %>%
  group_by(form, measure, lexical_category, category) %>%
  summarise(mean_aoa = mean(aoa, na.rm = TRUE),
            mean_cds_log_frequency = mean(cds_log_frequency, na.rm = TRUE))

ggplot(cat_means, aes(x = mean_cds_log_frequency, y = mean_aoa)) +
  facet_wrap(~ form + measure) +
  geom_text(aes(label = category, colour = lexical_category)) +
  geom_smooth(method = "lm", colour = "black") +
  scale_colour_solarized() +
  xlab("Mean log frequency in child-directed speech") +
  ylab("Mean age of acquisition (months)")
```

This is an exploratory analysis looking at using various lexical factors -- words' frequency, psycholinguistic metrics, and phonological characteristics -- as predictors of age of acquisition.

Acquisition data is from the Wordbank database of CDI administrations, using production data from the English Words & Sentences form (16-30 months) and comprehension data from the English Words & Gestures form (8-18 months). Each word's age of acquisition is calculated as the youngest age (in months) at which at least 50% of children in the dataset produce/comprehend the word (following Goodman, Dale, Li, 2007).

Frequency in child-directed speech is from the CHILDES database. All other lexical factors are from the MRC Psycholinguistic Database.
